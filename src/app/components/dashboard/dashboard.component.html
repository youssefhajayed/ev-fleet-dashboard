<h2>EV Fleet Telemetry</h2>

<!-- Google Map -->
<div class="map-container">
  <google-map height="500px" width="100%" [zoom]="12" [center]="mapCenter">
    <ng-container *ngIf="vehicles$ | async as vehicles">
      <ng-container *ngFor="let vehicle of vehicles | keyvalue">
        <map-marker
          [position]="vehicle.value.location"
          [label]="
            vehicle.value.carStatus
              ? 'ğŸš—' + vehicle.value.id
              : 'ğŸš— ' + vehicle.value.id
          "
          [icon]="
            vehicle.value.carStatus
              ? 'âš¡'
              : 'ğŸš— '
          "
        >
        </map-marker>
      </ng-container>
    </ng-container>
  </google-map>
</div>

<!-- Vehicle Grid -->
<div class="grid-container">
  <ng-container *ngIf="vehicles$ | async as vehicles">
    <div
      *ngFor="
        let vehicle of vehicles | keyvalue : vehicleOrder;
        trackBy: trackByVehicleId
      "
      class="vehicle-card"
      [class.low-battery]="vehicle.value.battery >= 10 && vehicle.value.battery < 30 && vehicle.value.carStatus !== 'Charging'"
      [class.critical-battery]="vehicle.value.battery < 10 && vehicle.value.carStatus !== 'Charging'"
      [class.chargingBattery]="vehicle.value.carStatus === 'Charging'"

    >
      <h3>ğŸš— Vehicle {{ vehicle.value.id }}</h3>
      <p> â„¹ï¸  Status : {{ vehicle.value.carStatus }}</p>
      <p>ğŸš€ Speed: {{ vehicle.value.speed }} km/h</p>
      <p>ğŸ”‹ Battery: {{ vehicle.value.battery }}%</p>
      <p>ğŸŒ¡ï¸ Temperature: {{ vehicle.value.temperature }}Â°C</p>
      <p>âš™ï¸ Tire Pressure: {{ vehicle.value.tirePressure }} PSI</p>
      <p>ğŸ”§ Motor Efficiency: {{ vehicle.value.motorEfficiency }}%</p>
      <p>ğŸ”„ Regen Braking: {{ vehicle.value.regenBraking ? "ON" : "OFF" }}</p>
      <p>ğŸ›‘ Brake Wear: {{ vehicle.value.brakeWear }}%</p>
      <p>âš¡ Energy Consumption: {{ vehicle.value.energyConsumption }} kWh</p>
      <p>ğŸ›£ï¸ Mileage: {{ vehicle.value.mileage }} km</p>
      <p>ğŸ“¡ LIDAR: {{ vehicle.value.lidarStatus ? "ACTIVE" : "INACTIVE" }}</p>
      <p>ğŸ“¡ RADAR: {{ vehicle.value.radarStatus ? "ACTIVE" : "INACTIVE" }}</p>
      <p>ğŸ“· Camera: {{ vehicle.value.cameraStatus ? "ACTIVE" : "INACTIVE" }}</p>
      <p>ğŸ¤– Autopilot: {{ vehicle.value.autopilotMode ? "ON" : "OFF" }}</p>
      <p>
        ğŸ“ Location: Lat {{ vehicle.value.location.lat.toFixed(5) }}, Lng
        {{ vehicle.value.location.lng.toFixed(5) }}
      </p>

      <p class="warning" *ngIf="vehicle.value.battery < 30 && vehicle.value.battery >= 10">
        âš ï¸ WARNING: Low Battery!
      </p>
      <p class="criticalWarning" *ngIf="vehicle.value.battery < 10">
        âš ï¸ WARNING: Critical Battery Level!
      </p>
      
    </div>
  </ng-container>
</div>
